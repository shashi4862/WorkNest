<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; }
        .dashboard-card { border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card { transition: transform 0.2s ease-in-out; }
        .stat-card:hover { transform: translateY(-5px); }
        .table-rounded { border-radius: 10px; overflow: hidden; }
        .card-header { background-color: #f8f9fa; border-bottom: none; }
    </style>
</head>
<body class="container mt-4">

<div th:replace="~{fragments/header :: header}"></div>

<h2 class="text-center mb-4 fw-bold text-primary">Admin Dashboard</h2>

<!-- Task Stats Section -->
<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="card stat-card text-white bg-info dashboard-card">
            <div class="card-body text-center">
                <i class="fas fa-clock fa-2x mb-2"></i>
                <h5 class="card-title">Pending Tasks</h5>
                <h1 class="card-text fw-bold" th:text="${pendingCount}">0</h1>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card text-white bg-warning dashboard-card">
            <div class="card-body text-center">
                <i class="fas fa-sync-alt fa-2x mb-2"></i>
                <h5 class="card-title">In Progress</h5>
                <h1 class="card-text fw-bold" th:text="${inProgressCount}">0</h1>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card text-white bg-success dashboard-card">
            <div class="card-body text-center">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <h5 class="card-title">Completed Tasks</h5>
                <h1 class="card-text fw-bold" th:text="${completedCount}">0</h1>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card text-white bg-danger dashboard-card">
            <div class="card-body text-center">
                <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                <h5 class="card-title">Delayed Tasks</h5>
                <h1 class="card-text fw-bold" th:text="${delayedCount}">0</h1>
            </div>
        </div>
    </div>
</div>

<!-- Assign Task Section -->
<div class="row g-4">
    <div class="col-md-6">
        <div class="card dashboard-card h-100">
            <div class="card-header fw-bold text-primary">Assign Task Manually</div>
            <div class="card-body">
                <form action="/admin/assign-task" method="post">
    <div class="mb-3">
        <label for="taskTitle" class="form-label">Task Title</label>
        <input type="text" class="form-control" id="taskTitle" name="taskTitle" required>
    </div>

    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description" required></textarea>
    </div>

    <div class="mb-3">
        <label for="startDate" class="form-label">Start Date</label>
        <input type="date" class="form-control" id="startDate" name="startDate" required>
    </div>

    <div class="mb-3">
        <label for="dueDate" class="form-label">Due Date</label>
        <input type="date" class="form-control" id="dueDate" name="dueDate" required>
    </div>

    <!-- Dropdown for Users -->
    <div class="mb-3">
        <label for="userId" class="form-label">Assign To User</label>
        <select class="form-select" id="userId" name="userId" required>
            <option value="">-- Select User --</option>
            <option th:each="user : ${users}"
                    th:value="${user.id}"
                    th:text="${user.name}">
            </option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary w-100 mt-3">Assign Task</button>
</form>

            </div>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="col-md-6">
        <div class="card dashboard-card h-100">
            <div class="card-header fw-bold text-primary">User Comments</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-rounded">
                        <thead>
                        <tr>
                            <th>User</th>
                            <th>Task</th>
                            <th>Comment</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="comment : ${comments}">
                            <td th:text="${comment.author.name}"></td>
                            <td th:text="${comment.assignment.task.title}"></td>
                            <td th:text="${comment.content}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- All Assignments Table -->
<div class="mt-5" id="all-assignments-table">
    <div class="card dashboard-card">
        <div class="card-header fw-bold text-primary">All Assigned Tasks</div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-rounded">
                    <thead>
                    <tr>
                        <th>Task Title</th>
                        <th>Assigned To</th>
                        <th>Status</th>
                        
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="assignment : ${allAssignments}">
                        <td th:text="${assignment.task.title}"></td>
                        <td th:text="${assignment.user.name}"></td>
                        <td th:text="${assignment.status}"></td>
                        
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Modal for success message -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="successModalLabel">Success!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="fw-bold fs-5" th:text="${successMessage}"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script th:if="${successMessage}">
    document.addEventListener('DOMContentLoaded', (event) => {
        var successModal = new bootstrap.Modal(document.getElementById('successModal'));
        successModal.show();
    });
</script>

</body>
</html>